clear all
close all

addpath('modelspecific');
addpath('mexfiles');
addpath('multigs');
global fitfn resfn degenfn psize numpar
fitfn = 'homography_fit';

data=[
531.325, 181.666, 96.3561, 192.73;
 611.344, 237.259, 170.214, 240.126;
 611.344, 237.259, 170.214, 240.126;
 580.456, 234.638, 145.375, 239.707;
 523.79, 329.37, 100.327, 342.232;
 479.483, 165.414, 36.2083, 172.693;
 565.306, 232.424, 132.757, 239.589;
 461.158, 166.914, 11.9085, 173.77;
 560.738, 218.768, 126.568, 226.667;
 526.252, 146.023, 88.976, 155.849;
 592.824, 310.315, 163.01, 305.273;
 555.937, 336.5, 131.769, 339.705;
 569.743, 242.423, 138.001, 248.315;
 569.684, 222.214, 135.237, 229.587;
 480.719, 155.278, 35.8913, 161.095;
 538.039, 146.169, 100.666, 157.543;
 458.891, 358, 27.0326, 402.167;
 552.77, 364.906, 131.43, 367.545;
 452.75, 395.351, 18.8709, 451.213;
 487.106, 357.622, 62.9668, 388.391;
 592.37, 223.133, 152.765, 229.347;
 594.104, 216.008, 154.499, 222.737;
 494.492, 428.783, 76.5428, 462.982;
 524.414, 156.491, 87.311, 165.998;
 539.029, 155.462, 102.705, 165.764;
 494.826, 409.397, 76.0062, 440.806;
 455.741, 371.72, 22.0098, 420.834;
 550.197, 346.747, 128.144, 351.018;
 553.999, 323.377, 131.135, 327.263;
 604.552, 193.194, 162.04, 202.529;
 490.061, 164.95, 48.9454, 172.96;
 545.936, 150.152, 108.961, 162.883;
 514.489, 234.784, 84.2141, 247.058;
 507.685, 236.769, 77.1064, 250.086;
 525.05, 247.27, 97.0582, 258.646;
 524.882, 250.669, 97.6075, 261.884;
 577.044, 324.07, 151.13, 321.522;
 461.865, 348.815, 30.5497, 389.782;
 480.11, 381.609, 55.9682, 418.571;];
data_orig = [ data(1:2,:) ; ones(1,size(data,2)) ; data(3:4,:) ; ones(1,size(data,2)) ];
[ dat_norm_img1,T1 ] = normalise2dpts(data_orig(1:3,:));
[ dat_norm_img2,T2 ] = normalise2dpts(data_orig(4:6,:));
data_norm = [ dat_norm_img1 ; dat_norm_img2 ];
[ h,A,D1,D2 ] = feval(fitfn,data_norm);
fprintf('size(data,1) =  %d\n',size(data,1));
Hg = T2\(reshape(h,3,3)*T1)
Hg=Hg./Hg(3,3)
% fprintf('done (%fs)\n',toc);